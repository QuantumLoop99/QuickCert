<div class="application-container">
  <!-- Page Title -->
  <div class="page-title">
    Income Statement Request Form
  </div>
  
  <!-- Success Notification -->
  <div *ngIf="showNotification" class="notification success-notification">
    <div class="notification-content">
      <span class="notification-icon">✓</span>
      <div class="notification-text">
        <h4>Application Submitted Successfully!</h4>
        <p>Your reference number is: <strong>{{ referenceNumber }}</strong></p>
        <p>Please save this reference number for tracking your application.</p>
      </div>
      <button class="notification-close" (click)="showNotification = false">×</button>
    </div>
  </div>

  <div class="content-wrapper">
    <!-- Form Title -->
    <h1 class="form-title">Request Income Statement Certificate</h1>
    <p class="form-subtitle">Please complete the form below to request your income statement certificate.</p>
    
    <!-- Reference Number Display -->
    <div class="reference-number-display">
      <span class="reference-label">Reference Number:</span>
      <span class="reference-number">{{ referenceNumber }}</span>
    </div>

    <!-- Form Container -->
    <div class="form-container">
      <form [formGroup]="applicationForm" (ngSubmit)="onSubmit()">
        
        <!-- Personal Information Section -->
        <div class="form-section">
          <h2 class="section-title">Personal Information</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label for="firstName" class="form-label">First Name *</label>
              <input type="text" id="firstName" class="form-control" formControlName="firstName" placeholder="Enter your first name">
              <div *ngIf="f['firstName'].touched && f['firstName'].invalid" class="error-text">
                First name is required
              </div>
            </div>
            <div class="form-group">
              <label for="lastName" class="form-label">Last Name *</label>
              <input type="text" id="lastName" class="form-control" formControlName="lastName" placeholder="Enter your last name">
              <div *ngIf="f['lastName'].touched && f['lastName'].invalid" class="error-text">
                Last name is required
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="nicNumber" class="form-label">NIC Number *</label>
              <input type="text" id="nicNumber" class="form-control" formControlName="nicNumber" placeholder="e.g., 123456789V or 123456789012">
              <div *ngIf="f['nicNumber'].touched && f['nicNumber'].invalid" class="error-text">
                Valid NIC number is required (9 digits + V/X or 12 digits)
              </div>
            </div>
            <div class="form-group">
              <label for="dateOfBirth" class="form-label">Date of Birth *</label>
              <input type="date" id="dateOfBirth" class="form-control" formControlName="dateOfBirth">
              <div *ngIf="f['dateOfBirth'].touched && f['dateOfBirth'].invalid" class="error-text">
                Date of birth is required
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="emailAddress" class="form-label">Email Address *</label>
              <input type="email" id="emailAddress" class="form-control" formControlName="emailAddress" placeholder="Enter your email address">
              <div *ngIf="f['emailAddress'].touched && f['emailAddress'].invalid" class="error-text">
                Please enter a valid email address
              </div>
            </div>
            <div class="form-group">
              <label for="phoneNumber" class="form-label">Phone Number *</label>
              <input type="tel" id="phoneNumber" class="form-control" formControlName="phoneNumber" placeholder="0771234567">
              <div *ngIf="f['phoneNumber'].touched && f['phoneNumber'].invalid" class="error-text">
                Please enter a valid 10-digit phone number
              </div>
            </div>
          </div>
        </div>

        <!-- Address Information Section -->
        <div class="form-section">
          <h2 class="section-title">Address Information</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label for="addressLine1" class="form-label">Address Line 1 *</label>
              <input type="text" id="addressLine1" class="form-control" formControlName="addressLine1" placeholder="Enter address line 1">
              <div *ngIf="f['addressLine1'].touched && f['addressLine1'].invalid" class="error-text">
                Address line 1 is required
              </div>
            </div>
            <div class="form-group">
              <label for="addressLine2" class="form-label">Address Line 2</label>
              <input type="text" id="addressLine2" class="form-control" formControlName="addressLine2" placeholder="Enter address line 2 (optional)">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city" class="form-label">City *</label>
              <input type="text" id="city" class="form-control" formControlName="city" placeholder="Enter your city">
              <div *ngIf="f['city'].touched && f['city'].invalid" class="error-text">
                City is required
              </div>
            </div>
            <div class="form-group">
              <label for="province" class="form-label">Province *</label>
              <select id="province" class="form-control" formControlName="province">
                <option value="">Select Province</option>
                <option *ngFor="let province of provinces" [value]="province.value">{{ province.label }}</option>
              </select>
              <div *ngIf="f['province'].touched && f['province'].invalid" class="error-text">
                Province is required
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="postalCode" class="form-label">Postal Code *</label>
              <input type="text" id="postalCode" class="form-control" formControlName="postalCode" placeholder="Enter 5-digit postal code">
              <div *ngIf="f['postalCode'].touched && f['postalCode'].invalid" class="error-text">
                Valid 5-digit postal code is required
              </div>
            </div>
            <div class="form-group">
              <label for="gsDivision" class="form-label">GS Division</label>
              <input type="text" id="gsDivision" class="form-control" formControlName="gsDivision" placeholder="Enter the Grama Niladhari division code">
              <p class="help-text">Enter the Grama Niladhari division code</p>
            </div>
          </div>
        </div>

        <!-- Pension Information Section -->
        <div class="form-section">
          <h2 class="section-title">Pension Information</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label for="pensionType" class="form-label">Pension Type *</label>
              <select id="pensionType" class="form-control" formControlName="pensionType">
                <option value="">Select Pension Type</option>
                <option *ngFor="let type of pensionTypes" [value]="type.value">{{ type.label }}</option>
              </select>
              <div *ngIf="f['pensionType'].touched && f['pensionType'].invalid" class="error-text">
                Pension type is required
              </div>
            </div>
            <div class="form-group">
              <label for="pensionReferenceNumber" class="form-label">Pension/Reference Number</label>
              <input type="text" id="pensionReferenceNumber" class="form-control" formControlName="pensionReferenceNumber" placeholder="Enter pension reference number">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="retirementDate" class="form-label">Retirement Date</label>
              <input type="date" id="retirementDate" class="form-control" formControlName="retirementDate">
            </div>
            <div class="form-group">
              <label for="pensionStartDate" class="form-label">Pension Start Date</label>
              <input type="date" id="pensionStartDate" class="form-control" formControlName="pensionStartDate">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="lastEmployer" class="form-label">Last Employer/Department</label>
              <input type="text" id="lastEmployer" class="form-control" formControlName="lastEmployer" placeholder="Enter last employer or department">
            </div>
            <div class="form-group">
              <label for="lastDesignation" class="form-label">Last Designation</label>
              <input type="text" id="lastDesignation" class="form-control" formControlName="lastDesignation" placeholder="Enter last designation">
            </div>
          </div>
        </div>

        <!-- Income Details Section -->
        <div class="form-section">
          <h2 class="section-title">Income Details</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label for="monthlyPension" class="form-label">Monthly Pension (LKR) *</label>
              <input type="number" id="monthlyPension" class="form-control" formControlName="monthlyPension" placeholder="Enter monthly pension amount" min="0" step="0.01">
              <div *ngIf="f['monthlyPension'].touched && f['monthlyPension'].invalid" class="error-text">
                Monthly pension amount is required
              </div>
            </div>
            <div class="form-group">
              <label for="annualPension" class="form-label">Annual Pension (LKR) *</label>
              <input type="number" id="annualPension" class="form-control" formControlName="annualPension" placeholder="Annual pension (auto-calculated)" min="0" step="0.01" readonly>
              <div *ngIf="f['annualPension'].touched && f['annualPension'].invalid" class="error-text">
                Annual pension amount is required
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="otherIncomeSources" class="form-label">Other Income Sources (LKR)</label>
              <input type="number" id="otherIncomeSources" class="form-control" formControlName="otherIncomeSources" placeholder="Enter other income amount" min="0" step="0.01">
              <p class="help-text">Include any additional income such as rent, dividends, etc.</p>
            </div>
            <div class="form-group">
              <label for="taxFileNumber" class="form-label">Tax File Number (if applicable)</label>
              <input type="text" id="taxFileNumber" class="form-control" formControlName="taxFileNumber" placeholder="Enter tax file number">
            </div>
          </div>
        </div>

        <!-- Request Details Section -->
        <div class="form-section">
          <h2 class="section-title">Request Details</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="requestReason" class="form-label">Reason for Request *</label>
              <select id="requestReason" class="form-control" formControlName="requestReason">
                <option value="">Select reason for request</option>
                <option value="loan-application">Loan Application</option>
                <option value="visa-application">Visa Application</option>
                <option value="tax-purposes">Tax Purposes</option>
                <option value="legal-proceedings">Legal Proceedings</option>
                <option value="insurance-claim">Insurance Claim</option>
                <option value="government-benefit">Government Benefit Application</option>
                <option value="personal-records">Personal Records</option>
                <option value="other">Other</option>
              </select>
              <div *ngIf="f['requestReason'].touched && f['requestReason'].invalid" class="error-text">
                Please select a reason for your request
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group full-width">
              <label for="additionalInfo" class="form-label">Additional Information</label>
              <textarea id="additionalInfo" class="form-control" formControlName="additionalInfo" rows="4" placeholder="Provide any additional details about your request (optional)"></textarea>
              <p class="help-text">You may provide additional context or specific requirements for your income statement certificate.</p>
            </div>
          </div>
        </div>

        <!-- Supporting Documents Section -->
        <div class="form-section">
          <h2 class="section-title">Supporting Documents</h2>
          
          <!-- Upload Pension Payment Slips -->
          <div class="form-group">
            <label class="form-label">Upload Pension Payment Slips (Last 3 months) *</label>
            <div class="upload-container" (click)="paymentSlipInput.click()">
              <div class="upload-icon">📎</div>
              <p class="upload-text">Drag and drop files here or click to browse</p>
              <p class="upload-text">Accepted formats: PDF, JPG, PNG | Max size: 5MB</p>
            </div>
            <input #paymentSlipInput type="file" style="display: none" multiple accept=".pdf,.jpg,.jpeg,.png" (change)="onFileSelected($event)">
            
            <!-- Display Selected Payment Slip Files -->
            <div *ngIf="selectedFiles.length > 0" class="selected-files">
              <h4>Selected Payment Slip Files:</h4>
              <div *ngFor="let file of selectedFiles; let i = index" class="file-item">
                <span class="file-info">
                  <span class="file-name">{{ file.name }}</span>
                  <span class="file-size">({{ (file.size / 1024 / 1024).toFixed(2) }} MB)</span>
                </span>
                <button type="button" class="btn-remove" (click)="removeFile(i)">Remove</button>
              </div>
            </div>
          </div>

          <!-- Upload Pension Book/ID -->
          <div class="form-group">
            <label class="form-label">Upload Pension Book/ID (if applicable)</label>
            <div class="upload-container" (click)="pensionBookInput.click()">
              <div class="upload-icon">📎</div>
              <p class="upload-text">Drag and drop files here or click to browse</p>
              <p class="upload-text">Accepted formats: PDF, JPG, PNG | Max size: 5MB</p>
            </div>
            <input #pensionBookInput type="file" style="display: none" multiple accept=".pdf,.jpg,.jpeg,.png" (change)="onPensionBookSelected($event)">
            
            <!-- Display Selected Pension Book Files -->
            <div *ngIf="pensionBookFiles.length > 0" class="selected-files">
              <h4>Selected Pension Book Files:</h4>
              <div *ngFor="let file of pensionBookFiles; let i = index" class="file-item">
                <span class="file-info">
                  <span class="file-name">{{ file.name }}</span>
                  <span class="file-size">({{ (file.size / 1024 / 1024).toFixed(2) }} MB)</span>
                </span>
                <button type="button" class="btn-remove" (click)="removePensionBookFile(i)">Remove</button>
              </div>
            </div>
          </div>
          
          <p class="help-text">
            <strong>Required documents:</strong> Pension payment slips for the last 3 months. 
            <strong>Optional documents:</strong> Pension book, copy of NIC, or any relevant identification documents.
          </p>
        </div>

        <!-- Declaration Section -->
        <div class="form-section">
          <h2 class="section-title">Declaration</h2>
          <div class="form-group">
            <div class="checkbox-container">
              <input type="checkbox" id="declaration" formControlName="declaration">
              <label for="declaration" class="checkbox-label">
                I declare that the information provided in this application is true and correct to the best of my knowledge. 
                I understand that providing false or misleading information may result in legal consequences and rejection of my application. 
                I authorize the relevant authorities to verify the information provided and process my request for an income statement certificate.
              </label>
            </div>
            <div *ngIf="f['declaration'].touched && !f['declaration'].value" class="error-text">
              You must agree to the declaration to proceed with your application
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="submit-section">
          <button type="submit" class="btn btn-submit" [disabled]="!applicationForm.valid">
            <span *ngIf="!isSubmitted">Submit Application</span>
            <span *ngIf="isSubmitted">✓ Submitted</span>
          </button>
          
          <button *ngIf="isSubmitted" type="button" class="btn btn-reset" (click)="resetForm()">
            Submit New Application
          </button>
        </div>

        <!-- Form Status Display -->
        <div *ngIf="isSubmitted" class="submission-confirmation">
          <div class="confirmation-card">
            <div class="confirmation-icon">✅</div>
            <h3>Application Submitted Successfully!</h3>
            <p><strong>Reference Number:</strong> {{ referenceNumber }}</p>
            <p>Your application has been received and will be processed within 5-7 business days.</p>
            <p>Please keep your reference number for tracking purposes.</p>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
